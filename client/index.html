<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perudo Game</title>
</head>
<body>
    <h1>Welcome to Perudo</h1>
    <script>
    function logMessage(message) {
        const logDiv = document.getElementById("log");
        const newMessage = document.createElement("p");
        newMessage.textContent = message;
        logDiv.appendChild(newMessage);
    }

    function startPolling() {
        function poll() {
            fetch("/.netlify/functions/polling")
                .then(response => response.json())
                .then(data => {
                    if (data.messages && data.messages.length > 0) {
                        data.messages.forEach(msg => logMessage("📩 " + msg));
                    }
                    poll(); // Отправляем новый запрос
                })
                .catch(error => logMessage("❌ Polling error: " + error));
        }
        poll(); // Запускаем первый запрос
        logMessage("✅ Polling started...");
    }

    function sendMessage() {
        const message = prompt("Enter a message:");
        if (!message) return;

        fetch("/.netlify/functions/polling", {
            method: "POST",
            body: JSON.stringify({ message }),
            headers: { "Content-Type": "application/json" }
        }).then(() => logMessage("✅ Message sent: " + message));
    }
</script>

<button onclick="startPolling()">Start Polling</button>
<button onclick="sendMessage()">Send Message</button>
<div id="log"></div>

</body>
</html>
